{% extends 'base.html' %} {% block content %}
<section class="card">
    <h2>📊 Visualización de TDAs</h2>
    <h3>{{ results['invernadero'].nombre }} - {{ results['plan_nombre'] }}</h3>

    <div style="background: #f0f8ff; padding: 1rem; border-radius: 4px; margin: 1rem 0;">
        <p><strong>Tiempo visualizado:</strong> {{ tiempo if tiempo else 'Completo' }} segundos</p>
        <p><strong>Tiempo total del plan:</strong> {{ results['tiempo_optimo'] }} segundos</p>
    </div>

    <div style="text-align: center; margin: 2rem 0; background: white; padding: 1rem; border-radius: 4px;">
        <img src="{{ url_for('static', filename=image_path) }}?v={{ range(1000) | random }}" alt="Grafo TDA"
            style="max-width: 100%; height: auto; border: 1px solid #ddd; border-radius: 4px;">
    </div>

    <div style="background: #fffacd; padding: 1rem; border-radius: 4px; margin: 1rem 0;">
        <h4>Leyenda del Grafo:</h4>
        <ul>
            <li><strong>Plan:</strong> Nodo principal con el nombre del plan</li>
            <li><strong>Secuencia:</strong> Lista enlazada de instrucciones de riego (H-P)</li>
            <li><strong>Acciones por Tiempo:</strong> Instrucciones ejecutadas en cada segundo</li>
            <li><strong>Drones:</strong> Acciones específicas de cada dron</li>
        </ul>
    </div>

    <!-- Cambiar tiempo de visualización -->
    <div style="background: #f5f5f5; padding: 1rem; border-radius: 4px; margin: 1rem 0;">
        <form action="/generar_grafo" method="post">
            <label for="tiempo_t"><strong>Ver grafo hasta el segundo:</strong></label>
            <input type="number" name="tiempo_t" id="tiempo_t" min="1" max="{{ results['tiempo_optimo'] }}"
                value="{{ tiempo if tiempo else results['tiempo_optimo'] }}"
                style="width: 100px; padding: 0.5rem; margin: 0 1rem;">
            <button type="submit">🔄 Actualizar Grafo</button>
        </form>
    </div>

    <div style="margin-top: 2rem;">
        <a href="javascript:history.back()">
            <button>← Volver al Reporte</button>
        </a>
        <a href="/" style="margin-left: 1rem;">
            <button>🏠 Inicio</button>
        </a>
    </div>
</section>
{% endblock %}