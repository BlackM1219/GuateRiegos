{% extends 'base.html' %} {% block content %}
<section class="card">
    <h2>üìÅ Cargar Configuraci√≥n XML</h2>
    <form action="/upload" method="post" enctype="multipart/form-data">
        <input type="file" name="file" accept=".xml" required>
        <button type="submit">Cargar Archivo</button>
    </form>

    {% if mensaje %}
    <div style="color: green; margin-top: 1rem;">‚úì {{ mensaje }}</div>
    {% endif %} {% if error %}
    <div style="color: red; margin-top: 1rem;">‚úó {{ error }}</div>
    {% endif %}
</section>

{% if invernaderos %}
<section class="card">
    <h3>üå± Simular Plan de Riego</h3>
    <form action="/simulate" method="post">
        <div style="margin-bottom: 1rem;">
            <label for="invernadero"><strong>Seleccionar Invernadero:</strong></label>
            <select name="invernadero" id="invernadero" required onchange="actualizarPlanes()"
                style="width: 100%; padding: 0.5rem; margin-top: 0.5rem;">
                <option value="">-- Selecciona un invernadero --</option>
                {% for inv in invernaderos.iter() %}
                <option value="{{ inv.nombre }}">{{ inv.nombre }}</option>
                {% endfor %}
            </select>
        </div>

        <div style="margin-bottom: 1rem;">
            <label for="plan"><strong>Seleccionar Plan de Riego:</strong></label>
            <select name="plan" id="plan" required style="width: 100%; padding: 0.5rem; margin-top: 0.5rem;">
                <option value="">-- Primero selecciona un invernadero --</option>
                {% for inv in invernaderos.iter() %}
                {% for plan_nombre, secuencia in inv.planes.iter() %}
                <option value="{{ plan_nombre }}" data-invernadero="{{ inv.nombre }}" style="display:none;">{{
                    plan_nombre }}</option>
                {% endfor %}
                {% endfor %}
            </select>
        </div>

        <button type="submit">‚ñ∂ Simular</button>
    </form>
</section>

<section class="card">
    <h3>üìä Invernaderos Cargados</h3>
    {% for inv in invernaderos.iter() %}
    <div style="border: 1px solid #ddd; padding: 1rem; margin-bottom: 1rem; border-radius: 4px;">
        <h4>{{ inv.nombre }}</h4>
        <p><strong>Hileras:</strong> {{ inv.numero_hileras }} | <strong>Plantas por hilera:</strong> {{
            inv.plantas_por_hilera }}</p>
        <p><strong>Planes disponibles:</strong></p>
        <ul>
            {% for plan_nombre, secuencia in inv.planes.iter() %}
            <li>{{ plan_nombre }}</li>
            {% endfor %}
        </ul>
    </div>
    {% endfor %}
</section>

<script>
    function actualizarPlanes() {
        var invSelect = document.getElementById('invernadero');
        var planSelect = document.getElementById('plan');
        var invNombre = invSelect.value;

        var allOptions = planSelect.getElementsByTagName('option');
        for (var i = 0; i < allOptions.length; i++) {
            if (i === 0) {
                allOptions[i].style.display = 'block';
                allOptions[i].selected = true;
            } else {
                var optionInv = allOptions[i].getAttribute('data-invernadero');
                if (optionInv === invNombre) {
                    allOptions[i].style.display = 'block';
                } else {
                    allOptions[i].style.display = 'none';
                }
            }
        }
    }
</script>
{% endif %}

<section class="card" style="text-align: center;">
    <a href="/ayuda">
        <button>‚ùì Ayuda</button>
    </a>
</section>

{% endblock %}